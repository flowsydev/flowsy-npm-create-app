#!/usr/bin/env sh

set -e

staged_files="$(mktemp)"
trap 'rm -f "$staged_files"' EXIT

git diff --cached --name-only --diff-filter=ACMR > "$staged_files"

if [ ! -s "$staged_files" ]; then
  exit 0
fi

while IFS= read -r file; do
  [ -f "$file" ] || continue

  case "$file" in
    *.js|*.mjs|*.cjs|*.jsx)
      npx eslint --fix "$file"
      npx prettier --write "$file"
      ;;
    *.md)
      npx markdownlint --fix "$file"
      npx prettier --write "$file"
      ;;
  esac

  git add "$file"
done < "$staged_files"
